#!/bin/bash

export WINEDEBUG="-all"
export WINEPREFIX="$HOME/steam"

declare -A APP
APP=([tf2]=440
     [portal]=400)

die() {
  echo >&2 "$1" && exit 1
}

steam() {
  STEAM="$WINEPREFIX/drive_c/Program Files (x86)/Steam/Steam.exe"
  [[ ! -f "$STEAM" ]] && STEAM="$WINEPREFIX/drive_c/Program Files/Steam/Steam.exe"

  exec wine "$STEAM" "$*"
}

if [[ $# -eq 0 ]]; then
  steam
else
  case $1 in
    install)
      cd /tmp
      [[ ! -f SteamInstall.msi ]] && wget http://cdn.steampowered.com/download/SteamInstall.msi
      exec wine msiexec /i SteamInstall.msi ;;
    config)
      exec winecfg ;;
    *)
      ID="${APP[$1]}"

      [[ -z "$ID" ]] && die "$0: can't launch $1"
      steam -applaunch "$ID" -novid -dxlevel 9 ;;
  esac
fi
